/*!kxbrand(http://www.kxbrand.net)-11-04-2014 */
define(function(a,b){var c;c=c||function(a){"use strict";function c(a,b,c){var d;for(d in l.prototype)l.prototype.hasOwnProperty(d)&&(a[d]=l.prototype[d]);return a.xregexp={captureNames:b,isNative:!!c},a}function d(a){return(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":"")}function e(a,b,e){if(!l.isRegExp(a))throw new TypeError("type RegExp expected");var f=p.replace.call(d(a)+(b||""),x,"");return e&&(f=p.replace.call(f,new RegExp("["+e+"]+","g"),"")),a=a.xregexp&&!a.xregexp.isNative?c(l(a.source,f),a.xregexp.captureNames?a.xregexp.captureNames.slice(0):null):c(new RegExp(a.source,f),null,!0)}function f(a,b){var c=a.length;if(Array.prototype.lastIndexOf)return a.lastIndexOf(b);for(;c--;)if(a[c]===b)return c;return-1}function g(a,b){return Object.prototype.toString.call(a).toLowerCase()==="[object "+b+"]"}function h(a){return a=a||{},"all"===a||a.all?a={natives:!0,extensibility:!0}:g(a,"string")&&(a=l.forEach(a,/[^\s,]+/,function(a){this[a]=!0},{})),a}function i(a,b,c,d){var e,f,g=s.length,h=null;B=!0;try{for(;g--;)if(f=s[g],!("all"!==f.scope&&f.scope!==c||f.trigger&&!f.trigger.call(d))&&(f.pattern.lastIndex=b,e=q.exec.call(f.pattern,a),e&&e.index===b)){h={output:f.handler.call(d,e,c),match:e};break}}catch(i){throw i}finally{B=!1}return h}function j(a){l.addToken=m[a?"on":"off"],o.extensibility=a}function k(a){RegExp.prototype.exec=(a?q:p).exec,RegExp.prototype.test=(a?q:p).test,String.prototype.match=(a?q:p).match,String.prototype.replace=(a?q:p).replace,String.prototype.split=(a?q:p).split,o.natives=a}var l,m,n,o={natives:!1,extensibility:!1},p={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},q={},r={},s=[],t="default",u="class",v={"default":/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/,"class":/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/},w=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,x=/([\s\S])(?=[\s\S]*\1)/g,y=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,z=p.exec.call(/()??/,"")[1]===a,A=RegExp.prototype.sticky!==a,B=!1,C="gim"+(A?"y":"");return l=function(b,d){if(l.isRegExp(b)){if(d!==a)throw new TypeError("can't supply flags when constructing one RegExp from another");return e(b)}if(B)throw new Error("can't call the XRegExp constructor within token definition functions");var f,g,h,j=[],k=t,m={hasNamedCapture:!1,captureNames:[],hasFlag:function(a){return d.indexOf(a)>-1}},n=0;if(b=b===a?"":String(b),d=d===a?"":String(d),p.match.call(d,x))throw new SyntaxError("invalid duplicate regular expression flag");for(b=p.replace.call(b,/^\(\?([\w$]+)\)/,function(a,b){if(p.test.call(/[gy]/,b))throw new SyntaxError("can't use flag g or y in mode modifier");return d=p.replace.call(d+b,x,""),""}),l.forEach(d,/[\s\S]/,function(a){if(C.indexOf(a[0])<0)throw new SyntaxError("invalid regular expression flag "+a[0])});n<b.length;)f=i(b,n,k,m),f?(j.push(f.output),n+=f.match[0].length||1):(g=p.exec.call(v[k],b.slice(n)),g?(j.push(g[0]),n+=g[0].length):(h=b.charAt(n),"["===h?k=u:"]"===h&&(k=t),j.push(h),++n));return c(new RegExp(j.join(""),p.replace.call(d,/[^gimy]+/g,"")),m.hasNamedCapture?m.captureNames:null)},m={on:function(a,b,c){c=c||{},a&&s.push({pattern:e(a,"g"+(A?"y":"")),handler:b,scope:c.scope||t,trigger:c.trigger||null}),c.customFlags&&(C=p.replace.call(C+c.customFlags,x,""))},off:function(){throw new Error("extensibility must be installed before using addToken")}},l.addToken=m.off,l.cache=function(a,b){var c=a+"/"+(b||"");return r[c]||(r[c]=l(a,b))},l.escape=function(a){return p.replace.call(a,/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},l.exec=function(a,b,c,d){var f,g=e(b,"g"+(d&&A?"y":""),d===!1?"y":"");return g.lastIndex=c=c||0,f=q.exec.call(g,a),d&&f&&f.index!==c&&(f=null),b.global&&(b.lastIndex=f?g.lastIndex:0),f},l.forEach=function(a,b,c,d){for(var e,f=0,g=-1;e=l.exec(a,b,f);)c.call(d,e,++g,a,b),f=e.index+(e[0].length||1);return d},l.globalize=function(a){return e(a,"g")},l.install=function(a){a=h(a),!o.natives&&a.natives&&k(!0),!o.extensibility&&a.extensibility&&j(!0)},l.isInstalled=function(a){return!!o[a]},l.isRegExp=function(a){return g(a,"regexp")},l.matchChain=function(a,b){return function c(a,d){var e,f=b[d].regex?b[d]:{regex:b[d]},g=[],h=function(a){g.push(f.backref?a[f.backref]||"":a[0])};for(e=0;e<a.length;++e)l.forEach(a[e],f.regex,h);return d!==b.length-1&&g.length?c(g,d+1):g}([a],0)},l.replace=function(b,c,d,f){var g,h=l.isRegExp(c),i=c;return h?(f===a&&c.global&&(f="all"),i=e(c,"all"===f?"g":"","all"===f?"":"g")):"all"===f&&(i=new RegExp(l.escape(String(c)),"g")),g=q.replace.call(String(b),i,d),h&&c.global&&(c.lastIndex=0),g},l.split=function(a,b,c){return q.split.call(a,b,c)},l.test=function(a,b,c,d){return!!l.exec(a,b,c,d)},l.uninstall=function(a){a=h(a),o.natives&&a.natives&&k(!1),o.extensibility&&a.extensibility&&j(!1)},l.union=function(a,b){var c,d,e,f,h=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,i=0,j=function(a,b,e){var f=d[i-c];if(b){if(++i,f)return"(?<"+f+">"}else if(e)return"\\"+(+e+c);return a},k=[];if(!g(a,"array")||!a.length)throw new TypeError("patterns must be a nonempty array");for(f=0;f<a.length;++f)e=a[f],l.isRegExp(e)?(c=i,d=e.xregexp&&e.xregexp.captureNames||[],k.push(l(e.source).source.replace(h,j))):k.push(l.escape(e));return l(k.join("|"),b)},l.version="2.0.0",q.exec=function(b){var c,e,g,h,i;if(this.global||(h=this.lastIndex),c=p.exec.apply(this,arguments)){if(!z&&c.length>1&&f(c,"")>-1&&(g=new RegExp(this.source,p.replace.call(d(this),"g","")),p.replace.call(String(b).slice(c.index),g,function(){var b;for(b=1;b<arguments.length-2;++b)arguments[b]===a&&(c[b]=a)})),this.xregexp&&this.xregexp.captureNames)for(i=1;i<c.length;++i)e=this.xregexp.captureNames[i-1],e&&(c[e]=c[i]);this.global&&!c[0].length&&this.lastIndex>c.index&&(this.lastIndex=c.index)}return this.global||(this.lastIndex=h),c},q.test=function(a){return!!q.exec.call(this,a)},q.match=function(a){if(l.isRegExp(a)){if(a.global){var b=p.match.apply(this,arguments);return a.lastIndex=0,b}}else a=new RegExp(a);return q.exec.call(a,this)},q.replace=function(a,b){var c,d,e,h,i=l.isRegExp(a);return i?(a.xregexp&&(c=a.xregexp.captureNames),a.global||(h=a.lastIndex)):a+="",g(b,"function")?d=p.replace.call(String(this),a,function(){var d,e=arguments;if(c)for(e[0]=new String(e[0]),d=0;d<c.length;++d)c[d]&&(e[0][c[d]]=e[d+1]);return i&&a.global&&(a.lastIndex=e[e.length-2]+e[0].length),b.apply(null,e)}):(e=String(this),d=p.replace.call(e,a,function(){var a=arguments;return p.replace.call(String(b),w,function(b,d,e){var g;if(d){if(g=+d,g<=a.length-3)return a[g]||"";if(g=c?f(c,d):-1,0>g)throw new SyntaxError("backreference to undefined group "+b);return a[g+1]||""}if("$"===e)return"$";if("&"===e||0===+e)return a[0];if("`"===e)return a[a.length-1].slice(0,a[a.length-2]);if("'"===e)return a[a.length-1].slice(a[a.length-2]+a[0].length);if(e=+e,!isNaN(e)){if(e>a.length-3)throw new SyntaxError("backreference to undefined group "+b);return a[e]||""}throw new SyntaxError("invalid token "+b)})})),i&&(a.lastIndex=a.global?0:h),d},q.split=function(b,c){if(!l.isRegExp(b))return p.split.apply(this,arguments);var d,e=String(this),f=b.lastIndex,g=[],h=0;return c=(c===a?-1:c)>>>0,l.forEach(e,b,function(a){a.index+a[0].length>h&&(g.push(e.slice(h,a.index)),a.length>1&&a.index<e.length&&Array.prototype.push.apply(g,a.slice(1)),d=a[0].length,h=a.index+d)}),h===e.length?(!p.test.call(b,"")||d)&&g.push(""):g.push(e.slice(h)),b.lastIndex=f,g.length>c?g.slice(0,c):g},n=m.on,n(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4})|x(?![\dA-Fa-f]{2}))/,function(a,b){if("B"===a[1]&&b===t)return a[0];throw new SyntaxError("invalid escape "+a[0])},{scope:"all"}),n(/\[(\^?)]/,function(a){return a[1]?"[\\s\\S]":"\\b\\B"}),n(/(?:\(\?#[^)]*\))+/,function(a){return p.test.call(y,a.input.slice(a.index+a[0].length))?"":"(?:)"}),n(/\\k<([\w$]+)>/,function(a){var b=isNaN(a[1])?f(this.captureNames,a[1])+1:+a[1],c=a.index+a[0].length;if(!b||b>this.captureNames.length)throw new SyntaxError("backreference to undefined group "+a[0]);return"\\"+b+(c===a.input.length||isNaN(a.input.charAt(c))?"":"(?:)")}),n(/(?:\s+|#.*)+/,function(a){return p.test.call(y,a.input.slice(a.index+a[0].length))?"":"(?:)"},{trigger:function(){return this.hasFlag("x")},customFlags:"x"}),n(/\./,function(){return"[\\s\\S]"},{trigger:function(){return this.hasFlag("s")},customFlags:"s"}),n(/\(\?P?<([\w$]+)>/,function(a){if(!isNaN(a[1]))throw new SyntaxError("can't use integer as capture name "+a[0]);return this.captureNames.push(a[1]),this.hasNamedCapture=!0,"("}),n(/\\(\d+)/,function(a,b){if(!(b===t&&/^[1-9]/.test(a[1])&&+a[1]<=this.captureNames.length)&&"0"!==a[1])throw new SyntaxError("can't use octal escape or backreference to undefined group "+a[0]);return a[0]},{scope:"all"}),n(/\((?!\?)/,function(){return this.hasFlag("n")?"(?:":(this.captureNames.push(null),"(")},{customFlags:"n"}),"undefined"!=typeof b&&(b.XRegExp=l),l}()});